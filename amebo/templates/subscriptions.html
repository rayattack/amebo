{% extends 'abase.axml' %} {% from 'actions.axml' import pagination %} {% macro
commander() %} { isFilterable: false, oldPagination: pagination, idSearch: '',
eventSearch: '', producerSearch: '', endpointSearch: '', descriptionSearch: '',
whenFilter: '', filterResults(){ let base =
`/v1/subscribers?pagination=${100}&page=${page}` if(this.idSearch) base =
`${base}&id=${this.idSearch}` if(this.eventSearch) base =
`${base}&event=${this.eventSearch}` if(this.producerSearch) base =
`${base}&producer=${this.producerSearch}` if(this.endpointSearch) base =
`${base}&endpoint=${this.endpointSearch}` if(this.descriptionSearch) base =
`${base}&description=${this.descriptionSearch}` if(this.whenFilter) base =
`${base}&timeline=${this.whenFilter}` fetch(`${base}`) .then(response =>
response.json()) .then(data => { isFiltering = true; subscribers = data;
}).catch(err => { ShowFeedback('error', 'Filter operation failed...') }) },
clearFilter(){ this.idSearch = ''; this.eventSearch = ''; this.producerSearch =
''; this.endpointSearch = ''; this.descriptionSearch = ''; this.whenFilter = '';
isFiltering = false; fetchAll(); }, checkDirty(){ if(this.idSearch !== '' ||
this.eventSearch !== '' || this.producerSearch !== '' || this.endpointSearch !==
'' || this.descriptionSearch !== '' || this.whenFilter !== '') {
this.isFilterable = true; return true; } this.isFilterable = false; return
false; } } {% endmacro %} {% block easel %}
<section x-data="{{ controller('subscriptions') }}">
    <div><span class="px-3 font-800">Filters:</span></div>
    <div class="px-3 pb-2" x-data="{{ commander() }}" x-effect="checkDirty">
        <span class="display-inline-block">
            <input
                type="text"
                placeholder="s. id"
                x-model="idSearch"
                style="width: 5em"
            />
            <input
                type="text"
                placeholder="producer name..."
                style="width: 13em"
                x-model="producerSearch"
            />
            <input
                type="text"
                placeholder="event name..."
                style="width: 15em"
                x-model="eventSearch"
            />
            <input
                style="width: 14em"
                type="text"
                placeholder="susbscription endpoint..."
                x-model="endpointSearch"
            />
            <input
                type="text"
                placeholder="subscription description..."
                style="width: 18em"
                x-model="descriptionSearch"
            />
            <select x-model="whenFilter">
                <option>Select Day</option>
                <template
                    x-for="[val, txt] in Object.entries({today: 'Today', week: 'This Week', month: 'This Month'})"
                    :key="val"
                >
                    <option :value="val" x-text="txt"></option>
                </template>
            </select>
            <button @click="filterResults" :disabled="! isFilterable">
                <ion-icon name="search" class="font-size-xs"></ion-icon>
                search
            </button>
            <button disabled>&nbsp;</button>
            <button @click.self="clearFilter" :disabled="! isFiltering">
                clear filter
                <ion-icon name="leaf-outline" class="font-size-xs"></ion-icon>
            </button>
        </span>
    </div>

    <div class="easel" x-init="calculateHeight($el, 10); fetchAll()">
        <table class="table is-striped is-fullwidth is-hoverable paginated">
            <thead>
                <th style="width: 5%">SID</th>
                <th>Application</th>
                <th>Action</th>
                <th>Endpoint</th>
                <th>Description</th>
                <th>Timestamped</th>
            </thead>
            <tbody x-init="() => { calculateHeight($el, 100); }">
                <template x-for="subs in subscriptions">
                    <tr>
                        <td x-text="sub.subscription" style="width: 5%"></td>
                        <td x-text="sub.producer"></td>
                        <td x-text="sub.action"></td>
                        <td>
                            <code
                                x-text="sub.endpoint"
                                class="font-size-sm"
                            ></code>
                        </td>
                        <td x-text="truncate(sub.description, 40)"></td>
                        <td x-text="sub.timestamped"></td>
                    </tr>
                </template>
            </tbody>
            <tfoot style="position: sticky; bottom: 0">
                <th>Subscription</th>
                <th>Application</th>
                <th>Action</th>
                <th>Endpoint</th>
                <th>Description</th>
                <th>Timestamped</th>
            </tfoot>
        </table>
        {{ pagination() }}
    </div>
</section>
{% endblock %}
